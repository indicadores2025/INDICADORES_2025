{% extends "base.html" %}
{% block content %}
<div class="module">
    <h2>ğŸ“ GestiÃ³n de Preguntas</h2>

    <!-- Botones Excel -->
    <div style="margin-bottom: 15px;">
        <a href="/preguntas/descargar_ejemplo" class="btn">â¬‡ï¸ Descargar Ejemplo</a>
        <form action="/preguntas/importar_excel" method="POST" enctype="multipart/form-data" style="display:inline;">
            <input type="file" name="archivo" accept=".xlsx" required>
            <button type="submit">ğŸ“¤ Importar Excel</button>
        </form>
        <a href="/preguntas/exportar_excel" class="btn">ğŸ“„ Exportar Excel</a>
    </div>

    <!-- Formulario -->
    <form method="POST" style="margin-bottom: 20px;">
        <textarea name="texto" rows="3" maxlength="355" placeholder="Texto de la pregunta" required></textarea>

        <div class="form-inline">
            <select name="tipo" required>
                <option value="Texto">Texto</option>
                <option value="Monto">Monto</option>
                <option value="Decimal">Decimal</option>
                <option value="Porcentaje">Porcentaje</option>
                <option value="CLP">CLP</option>
            </select>

            <select name="presupuesto_id" id="presupuesto_id">
                <option value="">-- Presupuesto --</option>
                {% for p in presupuestos %}
                <option value="{{ p.id }}">{{ p.nombre }}</option>
                {% endfor %}
            </select>

            <select name="unidad_id" required>
                <option value="">-- Unidad --</option>
                {% for u in unidades %}
                <option value="{{ u.id }}">{{ u.nombre }}</option>
                {% endfor %}
            </select>

            <select name="usuario_id" required>
                <option value="">-- Usuario --</option>
                {% for us in usuarios %}
                <option value="{{ us.id }}">{{ us.nombre }}</option>
                {% endfor %}
            </select>

            <label><input type="checkbox" name="afecta_presupuesto" id="afecta_presupuesto" onchange="togglePresupuesto()"> Afecta Presupuesto</label>
            <button type="submit">ğŸ’¾ Agregar</button>
        </div>
    </form>

    <!-- Tabla -->
    <table border="1" width="100%" cellspacing="0" cellpadding="8">
        <tr style="background-color:#f97316;color:white;">
            <th>ID</th>
            <th>Pregunta</th>
            <th>Tipo</th>
            <th>Presupuesto</th>
            <th>Unidad</th>
            <th>Usuario</th>
            <th>Afecta</th>
            <th>Activo</th>
            <th>Acciones</th>
        </tr>
        {% for p in preguntas %}
        <tr>
            <td>{{ p.id }}</td>
            <td style="text-align:left;">{{ p.texto }}</td>
            <td>{{ p.tipo }}</td>
            <td>{{ p.presupuesto }}</td>
            <td>{{ p.unidad }}</td>
            <td>{{ p.usuario }}</td>
            <td>{{ 'SÃ­' if p.afecta_presupuesto else 'No' }}</td>
            <td>{{ 'SÃ­' if p.activo else 'No' }}</td>
            <td>
                <a href="/preguntas/editar/{{ p.id }}">âœï¸ Editar</a> |
                <a href="/preguntas/eliminar/{{ p.id }}" onclick="return confirm('Â¿Eliminar esta pregunta definitivamente?')">ğŸ—‘ï¸ Eliminar</a>
            </td>
        </tr>
        {% endfor %}
    </table>
</div>

<script>
function togglePresupuesto() {
    const check = document.getElementById("afecta_presupuesto");
    const select = document.getElementById("presupuesto_id");
    select.disabled = !check.checked;
    if (!check.checked) select.value = "";
}
window.addEventListener("DOMContentLoaded", togglePresupuesto);
</script>
{% endblock %}
