{% extends "base.html" %}
{% block content %}
<div class="module">
    <h2>ğŸ•µï¸ AuditorÃ­a de Respuestas</h2>

    <!-- FILTROS -->
    <form method="GET" class="form-inline">
        <select name="unidad_id">
            <option value="">-- Unidad --</option>
            {% for u in unidades %}
                <option value="{{ u.id }}" {% if filtros.unidad_id == u.id|string %}selected{% endif %}>{{ u.nombre }}</option>
            {% endfor %}
        </select>

        <select name="usuario_id">
            <option value="">-- Usuario --</option>
            {% for us in usuarios %}
                <option value="{{ us.id }}" {% if filtros.usuario_id == us.id|string %}selected{% endif %}>{{ us.nombre }}</option>
            {% endfor %}
        </select>

        <select name="mes">
            <option value="">-- Mes --</option>
            {% for m in ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"] %}
                <option value="{{ m }}" {% if filtros.mes == m %}selected{% endif %}>{{ m }}</option>
            {% endfor %}
        </select>

        <input type="number" name="aÃ±o" placeholder="AÃ±o" min="2000" max="2100" value="{{ filtros.aÃ±o }}">
        <button type="submit">ğŸ” Filtrar</button>
        <a href="/auditoria/exportar" class="btn">â¬‡ï¸ Exportar a Excel</a>
    </form>

    <hr>

    <!-- CARGA MASIVA -->
    <div style="margin:20px 0; border:1px solid #ddd; padding:10px; border-radius:8px;">
        <h3>ğŸ“¤ Carga Masiva de Respuestas</h3>
        <p>Descarga una planilla de ejemplo, completa las respuestas y sÃºbela aquÃ­.</p>
        <a href="/auditoria/ejemplo" class="btn" style="background:#28a745; color:white;">ğŸ“„ Descargar Ejemplo</a>

        <form method="POST" action="/auditoria/importar" enctype="multipart/form-data" style="margin-top:10px;">
            <input type="file" name="archivo" accept=".xlsx" required>
            <button type="submit" style="background:#f97316; color:white;">â¬†ï¸ Importar Respuestas</button>
        </form>
    </div>

    <!-- TABLA DE RESULTADOS -->
    {% if respuestas %}
    <table>
        <tr>
            <th>ID</th>
            <th>Pregunta</th>
            <th>Unidad</th>
            <th>Usuario</th>
            <th>Presupuesto</th>
            <th>Mes/AÃ±o</th>
            <th>Valor</th>
            <th>Fecha</th>
        </tr>
        {% for r in respuestas %}
        <tr>
            <td>{{ r.id }}</td>
            <td style="white-space:pre-wrap; max-width:350px;">{{ r.pregunta }}</td>
            <td>{{ r.unidad }}</td>
            <td>{{ r.usuario }}</td>
            <td>{{ r.presupuesto }}</td>
            <td>{{ r.mes }}/{{ r.aÃ±o }}</td>
            <td>{{ r.valor }}</td>
            <td>{{ r.fecha_ingreso }}</td>

            <td>
                <a href="/auditoria/editar/{{ r.id }}">âœï¸ Editar</a> |
                <a href="/auditoria/eliminar/{{ r.id }}" onclick="return confirm('Â¿Seguro que deseas eliminar esta respuesta?');">ğŸ—‘ï¸ Eliminar</a>
            </td>
        </tr>
        {% endfor %}
    </table>
    {% else %}
        <div class="alert-warning">âš ï¸ No se encontraron respuestas con los filtros seleccionados.</div>
    {% endif %}
</div>
{% endblock %}
